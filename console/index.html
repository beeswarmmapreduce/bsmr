<!DOCTYPE html>
<html>
    <head>
        <title>bsmr console</title>
        <script type="text/javascript" src="json2.js"></script>
        <script type="text/javascript" src="console.js"></script>
        <script type="text/javascript" src="jquery.js"></script>
        <style type="text/css">
            @import url(console.css);
        </style>
    </head>
    <body>
        <h1>
            BS/MR Console
        </h1>
        <div id="control">
            <label for="master">master</label>
            <input type="text" id="master" value="ws://localhost:8080/bsmr/" />
            <input type="button" id="connect" value="connect"/>
        </div>
        <div id="dashboard">
            <h2>Current work</h2>

            <h3>map</h3>
            <table id="splits">
                <tr class="queued">
                    <td class="label">queued</td>
                    <td class="value">0</td>
                </tr>
                <tr class="done">
                    <td class="label">done</td>
                    <td class="value">0</td>
                </tr>
            </table>
            <table id="splitsVisual" class="visual"></table>

            <h3>reduce</h3>
            <table id="partitions">
                <tr class="queued">
                    <td class="label">queued</td>
                    <td class="value">0</td>
                </tr>
                <tr class="done">
                    <td class="label">done</td>
                    <td class="value">0</td>
                </tr>
            </table>
            <table id="partitionsVisual" class="visual"></table>

            <h2>Workers (<span id="workerCount">0</span>)</h2>
            <table id="workers">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Url</th>
                        <th>Connected</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="template">
                        <td class="status"></td>
                        <td class="url"></td>
                        <td class="connectTime"></td>
                    </tr>
                </tbody>
            </table>
            <h2>Active job (<span id="activeJobCount">0</span>)</h2>
            <table id="activeJob" class="job-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>id</th>
                        <th>R</th>
                        <th>M</th>
                        <th>code</th>
                        <th>start</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="template">
                        <td class="tools"><a href="#" class="rm">rm</a></td>
                        <td class="jobId"></td>
                        <td class="R"></td>
                        <td class="M"></td>
                        <td class="code"><pre></pre></td>
                        <td class="startTime"></td>
                    </tr>
                <tbody>
            </table>
            <h2>Job queue (<span id="jobQueueCount">0</span>)</h2>
            <table id="jobQueue" class="job-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>id</th>
                        <th>R</th>
                        <th>M</th>
                        <th>code</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="template">
                        <td class="tools"><a href="#" class="rm">rm</a></td>
                        <td class="jobId"></td>
                        <td class="R"></td>
                        <td class="M"></td>
                        <td class="code"><pre></pre></td>
                    </tr>
                <tbody>
            </table>
            <h2>Job history (<span id="jobHistoryCount">0</span>)</h2>
            <table id="jobHistory" class="job-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>id</th>
                        <th>R</th>
                        <th>M</th>
                        <th>code</th>
                        <th>start</th>
                        <th>finish</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="template">
                        <td class="tools"><a href="#" class="rm">rm</a></td>
                        <td class="jobId"></td>
                        <td class="R"></td>
                        <td class="M"></td>
                        <td class="code"><pre></pre></td>
                        <td class="startTime"></td>
                        <td class="finishTime"></td>
                    </tr>
                <tbody>
            </table>
        </div>

        <div id="jobInput">
            <h2>Add job</h2>
            <form>
                <p>
                    <label for="inputRef">Input ref.</label>
                    <input type="text" id="inputRef" name="inputRef"/value="enwiki.xml">
                </p>
                <p>
                    <label for="M">Number splits (M)</label>
                    <input type="text" id="M" name="M"/value="10">
                </p>
                <p>
                    <label for="R">Number partitions (R)</label>
                    <input type="text" id="R" name="R" value="10"/>
                </p>
                <p>
                    <label for="heartbeatTimeout">Heartbeat timeout</label>
                    <input type="text" id="heartbeatTimeout" name="heartbeatTimeout" value="60000"/>
                </p>
                <p>
                    <label for="progressTimeout">Progress timeout</label>
                    <input type="text" id="progressTimeout" name="progressTimeout" value="300000"/>
                </p>
                <p>
                    <label for="inputPlugin">Input plugin</label>
                    <select id="inputPlugin">
                        <option value="null">Please select</option>
                    </select>
                    <div id="inputPluginParams"></div>
                </p>
                <p>
                    <label for="p2pPlugin">P2P plugin</label>
                    <select id="p2pPlugin">
                        <option value="null">Please select</option>
                    </select>
                    <div id="p2pPluginParams"></div>
                </p>
                <p>
                    <label for="outputPlugin">Output plugin</label>
                    <select id="outputPlugin">
                        <option value="null">Please select</option>
                    </select>
                    <div id="outputPluginParams"></div>
                </p>
                <p>
                    <label for="code" class="textarea">Job code</label>
                    <textarea id="jobCode">
mapper = function(pair, emit) {
    var word = pair[1];
    emit(word, '1');
}

/*
reducer = function() {
    var x = 0;
    while (y = yield) {
        x += parseInt(y, 10);
    }
    yield x.toString();
}
*/

reducer = function() {
    function Adder() {
        this.x = 0;
    }
    Adder.prototype = new Generator();
    Adder.prototype._step = function(y) {
        if (y) {
            this.x += parseInt(y, 10);
        }
        else {
            this._lastrun();
            var result = this.x.toString();
            this._emit(result);
        }
    }
    return new Adder();
}

combiner = reducer;

input = debuginput;

chooseBucket = function(key) {
    var bucketId = 0;
    for (var i = 0; i &lt; key.length; i++) {
        bucketId += key.charCodeAt(i);
        bucketId %= this.R;
    }
    return bucketId;
}
                    </textarea>
                </p>
                <p>
                    <input type="button" id="addJob" value="Add job"/>
                </p>
            </form>
        </div>
        <div id="log">
        </div>
    </body>
</html>
