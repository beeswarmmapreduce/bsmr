<html>
	<head>
		<title>Master Test</title>
		<script language="javascript">

		var ws;
		var url = "ws://localhost:8080/bsmr/";
		
		function connect()
		{
			if (("WebSocket" in window) == false) {
				alert('Your browser does not seem to support websockets.');
				return;
			}

			if (ws != null) {
				log("already connected");
				return;
			}
			
			ws = new WebSocket(url, "worker");
			
			protostring = "";
			  
			ws.onopen = function() {
				log("connection established, " + url + protostring);
			};
			
			ws.onclose = function() {
				log("connection closed, " + url + protostring);
				ws = null;
			};
			
			ws.onmessage = function(msg) {
			    log("received: '" + msg.data + "'");
			};
			
			ws.onerror = function() {
				log("websocket error: " + url + " " + protostring);
			};
		
		}

		function send()
		{
			if (ws != null) {
				ws.send('{ "type": "ACK", "action": "reduce" }');
			} else {
				log("not connected!");
			}
		}

		function heartbeat()
		{
			if (ws != null) {
				ws.send('{ "type": "ACK", "action": "heartbeat" }');
			} else {
				log("not connected!");
			}
		}

		function disconnect()
		{
			if (ws != null) {
				ws.close();
				log("disconnected");
				ws = null;
			} else {
				log("not connected!");
			}
		}

		function log(str) {
			document.all.status.innerHTML += '<p class="logline">' + str + "</p>"
		}
		
		</script>
		<style type="text/css">
		
		.logline {
			background: #ddffdd;
		}
		
		</style>
	</head>
	
	<body>
		<h1>Connect to me ...</h1>
		<p><a href="#" onclick="connect()">Connect</a> 
		   <a href="#" onclick="send()">Send!</a> 
		   <a href="#" onclick="heartbeat()">Heartbeat</a>
		   <a href="#" onclick="disconnect()">Disconnect!</a>
		</p>
		<div id="status"></div>
		
	</body>

</html>